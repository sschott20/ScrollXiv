// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Paper {
  id            String   @id @default(cuid())
  arxivId       String   @unique
  title         String
  authors       String   // JSON array of author names
  abstract      String
  categories    String   // JSON array of category strings
  publishedDate DateTime
  pdfUrl        String

  // AI-generated content (Layer 1 & 2 - quick summary)
  hook          String?  // Attention-grabbing one-liner
  keyConcepts   String?  // JSON array of key concepts
  summary       String?  // Brief summary
  whyMatters    String?  // Why this research matters

  // Deep summary (Layer 3 - detailed analysis)
  deepSummary   String?  // JSON: {category, contributions, methodology, findings, limitations, context, figureAnalysis}

  // Figure data from ar5iv
  figures        String?  // JSON array: [{url, caption, index}]
  selectedFigure String?  // JSON: {url, caption, index, reason}
  figuresError   String?  // Error message if extraction failed

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  savedBy       SavedPaper[]
  seenBy        SeenPaper[]
}

model SavedPaper {
  id        String   @id @default(cuid())
  paperId   String
  paper     Paper    @relation(fields: [paperId], references: [id])
  createdAt DateTime @default(now())

  @@unique([paperId])
}

model SeenPaper {
  id        String   @id @default(cuid())
  paperId   String
  paper     Paper    @relation(fields: [paperId], references: [id])
  discarded Boolean  @default(false) // true if user explicitly discarded, false if just seen
  createdAt DateTime @default(now())

  @@unique([paperId])
}
